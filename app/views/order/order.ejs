<% layout('../base') -%>
  <div class="container">
    <div class="row">
      <div class="col s12">
        <ul class="tabs">
          <li id="step1_tab" class="tab col s3"><a class="active" href="#step1">참여신청</a></li>
          <li id="step2_tab" class="tab col s3 disabled"><a id="step2_link" href="#step2">결제</a></li>
          <li id="step3_tab" class="tab col s3 disabled"><a href="#step3">참여신청완료</a></li>
        </ul>
      </div>
      <form action="/product/<%=product.id%>/order_done" method="post">
        <div id="step1" class="col s12">
          <span>
          안녕하세요. 함께 하게 될 <%=product.leader.username%>입니다.
          </span>
          <input type="text" name="introduction" placeholder="자기소개를 해주세요.스터디를 신청한 목적은 무엇인가요?" />
          <input type="text" name="contact" placeholder="스터디 안내를 드릴 연락처를 알려주세요!" />
          <a class="btn" id="step1_next">다음으로</a>
        </div>

        <div id="step2" class="col s12">
          결제 내용 어쩌구
          <input type="submit" value="결제없이 신청하기"/>
          <a id="pay_btn">결제하기</a>
        </div>
      </form>
    </div>
  </div>



  <script>
    $(document).ready(function() {
      var IMP = window.IMP;
      IMP.init('imp75819118'); //'iamport' 대신 부여받은 "가맹점 식별코드"를 사용.

      $('ul.tabs').tabs();
      $('#step1_next').click(function() {
        $('#step2_tab').removeClass('disabled');
        $('#step2_link').click();
      })

      $('#pay_btn').click(function() {
        IMP.request_pay({
          pg: 'inicis', // version 1.1.0부터 지원.
          /*
              'kakao':카카오페이,
              'inicis':이니시스, 'html5_inicis':이니시스(웹표준결제),
              'nice':나이스,
              'jtnet':jtnet,
              'uplus':LG유플러스
          */
          pay_method: 'trans', // 'card' : 신용카드 | 'trans' : 실시간계좌이체 | 'vbank' : 가상계좌 | 'phone' : 휴대폰소액결제
          merchant_uid: 'merchant_' + new Date().getTime(),
          name: '주문명:결제테스트',
          amount: 1000,
          buyer_email: 'iamport@siot.do',
          buyer_name: '구매자이름',
          buyer_tel: '010-1234-5678',
          buyer_addr: '서울특별시 강남구 삼성동',
          buyer_postcode: '123-456',
          app_scheme: 'iamporttest' //in app browser결제에서만 사용
        }, function(rsp) {
          if (rsp.success) {
            var msg = '결제가 완료되었습니다.';
            msg += '고유ID : ' + rsp.imp_uid;
            msg += '상점 거래ID : ' + rsp.merchant_uid;
            msg += '결제 금액 : ' + rsp.paid_amount;
            msg += '카드 승인번호 : ' + rsp.apply_num;
          } else {
            var msg = '결제에 실패하였습니다.';
            msg += '에러내용 : ' + rsp.error_msg;
          }
        });
      })
    });
  </script>
